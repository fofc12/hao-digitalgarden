---
{"dg-publish":true,"permalink":"/3/shared/wsn/1/"}
---



# 实验概览
**实验一 开发环境搭建实验（验证性，4学时）**
一、教学目的和要求
1. 了解实验平台创建新项目工程
2. 掌握工程配置

二、教学内容
1. 学习仿真器简介
2. 学习开发环境MDK简介及安装
3. 学习创建新项目工程
4. 学习工程基本配置
[物联网无线传感网络实验手册\-Wifi.pdf](物联网无线传感网络实验手册-Wifi.pdf)

## 实验任务
任务1 安装开发软件和 驱动（20%）
任务2 使用寄存器方式新建工程（30%）
任务3 使用库函数方式新建工程（40%）
任务4 \*使用STM32CubeMX新建工程（10%）


# 实验准备
[演示1\-开发环境搭建.pptx](演示1-开发环境搭建.pptx)
## 如何下载
首先工程配置中需要做好相关设置（指导书P27）
连接ST\-LINK下载器
![a056a92b5d132ae9b36a0f725bc3d64f.png](a056a92b5d132ae9b36a0f725bc3d64f.png)

																			   图 下载连接示意图

连接电源，可以用串口供电或侧面圆口5v供电
烧录后，按M3芯片上方（不是WIFI旁的）红色复位键运行程序

**常见问题**
stlink能识别，但下载不了
可能是下载口没有准备好或被占用，可以长按复位，松开一瞬间再去下载

有错误提示algorithm找不到
尝试打开工程设置\-debug，stlink右侧设置中，将一条algorithm删除再添加回来

# 实验步骤
## 任务1 安装开发软件和驱动（20%）
安装MDK，ST\-LINK驱动，CH340驱动等

## 任务2 使用寄存器方式新建工程（30%）
首先，打开MDK（以下将MDK5简称为MDK）软件。然后点击Project→New uVision Project

在桌面新建一个TEST的文件夹，然后在TEST文件夹里面新建USER文件夹，将工程名字设为test，保存在这个USER文件夹里面。

之后，弹出选择器件的对话框，因为开发板所使用的STM32型号为STM32F103RCT6，所以在这里我们选择STMicroelectronics→STM32F1 Series→STM32F103→STM32F103RCT6（如果使用的是其他系列的芯片，选择相应的型号就可以了，特别注意：**一定要安装对应的器件pack**才会显示这些内容哦！！如果没得选择，请关闭MDK，然后安装Keil.STM32F1xx\_DFP.xxx.pack这个安装包）。

点击OK，MDK会弹出Manage Run\-Time Environment对话框，这是MDK5新增的一个功能，在这个界面，我们可以添加自己需要的组件，从而方便构建开发环境，不过这里我们不做介绍。如果想了解在线安装，请参考**实验指导书3.2MDK建立工程**的章节。所以我们直接点击Cancel即可。

到这里，我们还只是建了一个框架，还需要添加启动代码，以及.c文件等。这里我们先介绍一下启动代码：启动代码是一段和硬件相关的汇编代码。是必不可少的！这代码主要作用如下：1、堆栈（SP）的初始化；2、初始化程序计数器（PC）；3、设置向量表异常事件的入口地址；4、调用main函数。感兴趣的朋友可以自己去分析这部分代码。

ST公司提供了3个启动文件给我们，分别用于不同容量的STM32芯片，这三个文件是：

startup\_stm32f10x\_ld.s

startup\_stm32f10x\_md.s

startup\_stm32f10x\_hd.s

其中，ld.s适用于小容量 产品；md.s适用于中等容量产品；hd适用于大容量产品；

这里的容量是指FLASH的大小.判断方法如下：

小容量：FLASH≤32K

中容量：64K≤FLASH≤128K

大容量：256K≤FLASH

我们开发板使用的是STM32F103RCT6，FLASH容量为256KB，属于大容量产品，所以我们选择startup\_stm32f10x\_hd.s作为我们的启动文件。

新建USER和SYSTEM两个组。然后点击Add Files按钮，把SYSTEM文件夹子文件夹里面的：\*.c加入到组中。注意：此时USER组下还是没有任何文件，

点击OK，退出该界面返回IDE。这时，我们在Target1树下发现多了2个组名，就是我们刚刚新建的2个组。

添加宏：STM32F10X\_H

## 任务3 使用库函数方式新建工程（40%）

与前一种方式类似，重新总结一下，即：

* 建立新的文件夹
* 复制官方文件
* 用户目录下也可建立src和inc
* 新建工程并选择芯片STM32F103RC
* 建立分组并添加文件
* 设置头文件路径，并添加相关宏STM32F10X\_HD
* 选择下载方式
* 新建main.c并将其添加到工程中
* 在main.c中编写相关代码
* 连接开发板并上电

区别在于：

多分组：DRIVER

添加宏：STM32F10X\_HD,USE\_STDPERIPH\_DRIVER

## 任务4 使用STM32CubeMX新建工程（10%）

STM32CubeMX运行需要JAVA运行时.

STM32CubeMX具体如何使用,请查看**实验指导手册3.5**。
